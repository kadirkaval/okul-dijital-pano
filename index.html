<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Okul Dijital Panosu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- <link rel="stylesheet" href="style.css"> -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
<style>
    /* --- (Responsive DeÄŸil, Scalable) --- */
:root {
  --bg-color: #eef1f5;
  --box-bg: #ffffff;
  --header-blue: #0d47a1;
  --header-cyan: #0097a7;
  --header-purple: #7b1fa2;
  --header-red: #d32f2f;
  --active-row: #ffe082;

  /* KRÄ°TÄ°K NOKTA: EkranÄ±n kÄ±sa kenarÄ±nÄ±n %1.4'Ã¼nÃ¼ baz al */
  /* Ekran kÃ¼Ã§Ã¼lÃ¼rse fontlar da kÃ¼Ã§Ã¼lÃ¼r, yerleÅŸim bozulmaz */
  font-size: 1.4vmin;
}

html,
body {
  height: 100vh; /* Tam ekran yÃ¼ksekliÄŸi */
  width: 100vw;
  margin: 0;
  overflow: hidden; /* Scroll Ã§ubuÄŸunu tamamen yasakla */
  background-color: var(--bg-color);
  font-family: "Segoe UI", sans-serif;
}

.container-fluid {
  height: 100%;
  padding: 1vmin; /* BoÅŸluklar da orantÄ±lÄ± */
  padding-bottom: 5vmin; /* Footer iÃ§in yer */
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
}

/* --- GRID YAPISI --- */
.main-grid {
  display: grid;
  grid-template-columns: 20% 55% 25%; /* SÃ¼tun oranlarÄ± */
  gap: 1vmin;
  height: 100%;
  overflow: hidden;
}

.col-panel {
  display: flex;
  flex-direction: column;
  gap: 1vmin;
  height: 100%;
  overflow: hidden;
}

/* --- KART TASARIMI --- */
.pano-card {
  background: var(--box-bg);
  border-radius: 1vmin;
  box-shadow: 0 0.5vmin 1vmin rgba(0, 0, 0, 0.1);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-height: 0; /* Flexbox taÅŸma sorununu Ã§Ã¶zer */
}

.card-header {
  color: white;
  font-weight: bold;
  text-align: center;
  padding: 0.6vmin;
  font-size: 1.2rem; /* root font-size'a gÃ¶re */
  text-transform: uppercase;
  flex-shrink: 0; /* Asla kÃ¼Ã§Ã¼lmesin */
  white-space: nowrap;
}

.card-body {
  flex: 1 1 auto; /* Esnek alan */
  display: flex;
  flex-direction: column;
  padding: 0.5vmin !important; /* Bootstrap padding'ini ez */
  overflow: hidden;
  position: relative;
  min-height: 0;
}

.text-center-box {
  align-items: center;
  justify-content: center;
  text-align: center;
}

/* --- ORTA SÃœTUN DENGESÄ° --- */
.slider-wrapper {
  flex: 3.5;
} /* Resim alanÄ± */
.schedule-area {
  flex: 5;
} /* Ders ProgramÄ± alanÄ± */
.time-out-card {
  flex: 1.5;
} /* SayaÃ§ alanÄ± */

/* --- Ã–ZEL METÄ°NLER --- */
.clock-box {
  font-size: 3.5rem;
  font-weight: bold;
  color: #333;
  line-height: 1;
}
.date-box {
  font-size: 1.1rem;
  color: #555;
}
.weather-temp {
  font-size: 3rem;
  font-weight: bold;
  color: var(--header-cyan);
  line-height: 1;
}
.countdown-box {
  font-size: 3rem;
  font-weight: 800;
  color: #d32f2f;
  font-family: "Courier New", monospace;
}

/* --- TABLOLAR --- */
.time-table,
.duty-table {
  width: 100%;
  border-collapse: collapse;
  height: 100%; /* Tabloyu alana yay */
  table-layout: fixed; /* SÃ¼tun geniÅŸliklerini sabitle */
}

.time-table th,
.duty-table th {
  background: #eee;
  padding: 0.5vmin;
  position: sticky;
  top: 0;
  z-index: 2;
  font-size: 1rem;
  text-align: center;
}

.time-table td,
.duty-table td {
  border-bottom: 1px solid #ddd;
  padding: 0; /* Ä°Ã§erik sÄ±ÄŸsÄ±n diye padding sÄ±fÄ±r */
  text-align: center;
  vertical-align: middle;
  font-size: 1rem;
  white-space: nowrap; /* YazÄ±lar alt satÄ±ra geÃ§mesin */
  overflow: hidden;
  text-overflow: ellipsis; /* SÄ±ÄŸmazsa ... koysun */
}

.active-slot {
  background-color: #f0e4c6 !important;
  font-weight: bold;
  border-left: 0.8vmin solid #d32f2f;
}

/* --- DUYURU --- */
.duyuru-container {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.duyuru-text {
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.5s;
  font-size: 1.5rem;
  font-weight: 600;
  text-align: center;
}
.duyuru-text.aktif {
  opacity: 1 !important;
  transform: translateY(0) !important;
}

/* --- RENKLER --- */
.bg-blue {
  background-color: var(--header-blue) !important;
}
.bg-cyan {
  background-color: var(--header-cyan) !important;
}
.bg-purple {
  background-color: var(--header-purple) !important;
}
.bg-red {
  background-color: var(--header-red) !important;
}
.bg-light-gray {
  background-color: #f8f9fa;
}

/* --- FOOTER --- */
.site-footer {
  height: 4vmin;
  background: linear-gradient(90deg, #0d47a1 0%, #1565c0 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 2vmin;
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  z-index: 1050;
  border-top: 0.4vmin solid #fbc02d;
  font-size: 0.9rem;
}

/* Listeler */
.list-group-item {
  background: transparent;
  padding: 0.5vmin 1vmin;
  font-size: 1rem;
}

</style>

</head>

<body>
    <div class="container-fluid">
        <div class="main-grid">

            <div class="col-panel">
                <div class="pano-card" style="flex: 0.8;">
                    <div class="card-header bg-cyan">SAAT & TARÄ°H</div>
                    <div class="card-body text-center-box">
                        <i class="bi bi-clock fw-bold" style="font-size: 3rem; color: var(--header-blue);"></i>
                        <div class="clock-box" id="liveClock">--:--</div>
                        <div class="date-box fw-semibold" id="dateTime">--.--.2025</div>
                    </div>
                </div>

                <div class="pano-card" style="flex: 1;">
                    <div class="card-header bg-success">HAVA DURUMU</div>
                    <div class="card-body text-center-box">
                        <img id="js-weather-icon" src="https://openweathermap.org/img/wn/02d@2x.png"
                            style="width: 8vmin;">
                        <div id="js-weather-temp" class="weather-temp">--Â°</div>
                        <div id="js-weather-desc" class="text-secondary fw-bold">YÃ¼kleniyor</div>
                    </div>
                </div>

                <div class="pano-card bg-light-gray" style="flex: 2;">
                    <div class="card-header bg-red">DUYURULAR</div>
                    <div class="card-body">
                        <div class="duyuru-container">
                            <div id="duyuru-metni" class="duyuru-text">
                                Duyurular yÃ¼kleniyor...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-panel">
                <div class="pano-card slider-wrapper">
                    <div id="carouselExample" class="carousel slide h-100" data-bs-ride="carousel">
                        <div class="carousel-inner h-100" id="new-foto">
                            <div class="carousel-item active h-100">
                                <img src="https://picsum.photos/1200/600" class="d-block w-100 h-100"
                                    style="object-fit: cover;">
                                <div class="carousel-caption d-none d-md-block"
                                    style="background: rgba(0,0,0,0.5); border-radius: 10px;">
                                    <h5>Okul Dijital Pano Sistemi</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pano-card schedule-area">
                    <div class="card-header bg-blue">DERS PROGRAMI</div>
                    <div class="card-body">
                        <table class="time-table">
                            <thead>
                                <tr>
                                    <th>Ders</th>
                                    <th>GiriÅŸ</th>
                                    <th>Ã‡Ä±kÄ±ÅŸ</th>
                                    <th>SÃ¼re</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="pano-card bg-light-gray time-out-card">
                    <div class="card-header bg-red">KALAN SÃœRE</div>
                    <div class="card-body text-center-box">
                        <div class="status-text fw-bold" id="bellStatus">Kontrol Ediliyor...</div>
                        <div class="countdown-box" id="countdown">--:--</div>
                    </div>
                </div>
            </div>

            <div class="col-panel">
                <div class="pano-card" style="flex: 2;">
                    <div class="card-header bg-blue">NÃ–BETÃ‡Ä° Ã–ÄžRETMENLER</div>
                    <div class="card-body">
                        <div class="border-bottom bg-light p-1 text-center">
                            <small class="text-muted fw-bold">NÃ¶betÃ§i Mdr. Yrd:</small>
                            <span id="amir-box" class="fw-bold text-danger">-</span>
                        </div>
                        <div style="flex-grow: 1; overflow-y: auto;">
                            <table class="duty-table">
                                <tbody id="duty-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="pano-card" style="flex: 1;">
                    <div class="card-header bg-red">RAPORLU / Ä°ZÄ°NLÄ°</div>
                    <div class="card-body" style="overflow-y: auto;">
                        <ul id="raporlu-listesi" class="list-group list-group-flush w-100"></ul>
                    </div>
                </div>

                <div class="pano-card" style="flex: 1;">
                    <div class="card-header bg-purple">BELÄ°RLÄ° GÃœNLER</div>
                    <div class="card-body" style="overflow-y: auto;">
                        <ul id="ozel-gun-listesi" class="list-group list-group-flush w-100 text-center"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-logo">BiliÅŸim Teknolojileri - Okul Dijital Panosu v1.0</div>
        <div class="footer-school-name fw-semibold fs-4">BORSA Ä°STANBUL MEHMET AKÄ°F ERSOY M.T.A.L</div>
        <div class="footer-creator text-reset" id="author">HazÄ±rlayan:</div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- <script src="script.js"></script> -->
     <script>
        // --- AYARLAR ---
const SHEET_ID = "1Nc2616kCclHxdIBfxSdcL9XOGXF1vRG_JEtwNqQHkvw";

// --- ZAMAN Ã‡Ä°ZELGESÄ° ---
const schedule = [];
shludeVerisiGeldi = function (json) {
  const rows = json.table.rows.slice(1); // BaÅŸlÄ±klarÄ± at
  const veriler = rows.map((row) => ({
    no: row.c[0] ? row.c[0].v : "",
    start: row.c[1] ? row.c[1].v : "",
    end: row.c[2] ? row.c[2].v : "",
  }));
  schedule.length = 0;
  veriler.forEach((item) => {
    if (item.no && item.start && item.end) {
      schedule.push({ no: item.no, start: item.start, end: item.end });
    }
  });
  renderTable();
};

renderTable();
function renderTable() {
  const tbody = document.getElementById("scheduleBody");
  if (!tbody) return; // Hata Ã¶nleyici
  let html = "";
  schedule.forEach((item) => {
    html += `<tr id="row-${item.no}">
                        <td>${item.no}. Ders</td>
                        <td>${item.start}</td>
                        <td>${item.end}</td>
                        <td>40dk</td>
                      </tr>`;
  });
  tbody.innerHTML = html;
}

// --- CANLI SAAT VE DERS DURUMU ---

function updateClock() {
  const now = new Date();
  const dateEl = document.getElementById("dateTime");
  const clockEl = document.getElementById("liveClock");

  if (dateEl)
    dateEl.innerText = now.toLocaleDateString("tr-TR", {
      day: "2-digit",
      month: "long",
      year: "numeric",
      weekday: "long",
    });
  if (clockEl)
    clockEl.innerText = now.toLocaleTimeString("tr-TR", {
      hour: "2-digit",
      minute: "2-digit",
    });
}

function updateSystem() {
  updateClock();
  const now = new Date();
  const currentMin = now.getHours() * 60 + now.getMinutes();
  const seconds = now.getSeconds();

  document
    .querySelectorAll("tr")
    .forEach((tr) => tr.classList.remove("active-slot"));

  let activeFound = false;
  const statusEl = document.getElementById("bellStatus");
  const countEl = document.getElementById("countdown");

  if (!statusEl || !countEl) return;

  for (let i = 0; i < schedule.length; i++) {
    const lesson = schedule[i];

    const [sh, sm] = lesson.start.split(":").map(Number);
    const [eh, em] = lesson.end.split(":").map(Number);
    const startMin = sh * 60 + sm;
    const endMin = eh * 60 + em;

    if (currentMin >= startMin && currentMin < endMin) {
      const diffMin = endMin - currentMin - 1;
      const diffSec = 60 - seconds;
      statusEl.innerText = `${lesson.no}. DERSÄ°N BÄ°TÄ°MÄ°NE:`;
      countEl.innerText = `${diffMin}:${
        diffSec < 10 ? "0" + diffSec : diffSec
      }`;

      const row = document.getElementById(`row-${lesson.no}`);
      if (row) row.classList.add("active-slot");

      countEl.style.color = "#dc3545"; // KÄ±rmÄ±zÄ± (Ders)
      activeFound = true;
      break;
    }

    if (i < schedule.length - 1) {
      const nextLessonStart = schedule[i + 1].start.split(":");
      const nextStartMin =
        parseInt(nextLessonStart[0]) * 60 + parseInt(nextLessonStart[1]);

      if (currentMin >= endMin && currentMin < nextStartMin) {
        const diffMin = nextStartMin - currentMin - 1;
        const diffSec = 60 - seconds;
        statusEl.innerText = `TENEFFÃœS`;
        countEl.innerText = `${diffMin}:${
          diffSec < 10 ? "0" + diffSec : diffSec
        }`;
        countEl.style.color = "#198754"; // YeÅŸil (TeneffÃ¼s)
        activeFound = true;
        break;
      }
    }
  }
  if (!activeFound) {
    statusEl.innerText = "GÄ°RÄ°Åž / Ã‡IKIÅž";
    countEl.innerText = "--:--";
    countEl.style.color = "#333"; // Beyaz (BoÅŸ)
  }
}
setInterval(updateSystem, 1000);

// --- HAVA DURUMU ---
const LAT = 40.77; // AdapazarÄ± koordinatÄ±
const LON = 30.4;

function havaDurumunuGetir() {
  const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&timezone=auto&_=${Date.now()}`;
  fetch(url)
    .then((response) => response.json())
    .then((data) => {
      const weather = data.current_weather;
      const temp = Math.round(weather.temperature);
      const code = weather.weathercode;

      const tempEl = document.getElementById("js-weather-temp");
      const descEl = document.getElementById("js-weather-desc");
      const iconEl = document.getElementById("js-weather-icon");

      if (tempEl) tempEl.innerText = `${temp}Â°`;

      let durumText = "Bilinmiyor";
      let iconCode = "01d";

      if (code === 0) {
        durumText = "AÃ§Ä±k";
        iconCode = "01d";
      } else if (code >= 1 && code <= 3) {
        durumText = "Bulutlu";
        iconCode = "02d";
      } else if (code >= 45 && code <= 48) {
        durumText = "Sisli";
        iconCode = "50d";
      } else if (code >= 51 && code <= 67) {
        durumText = "YaÄŸmurlu";
        iconCode = "10d";
      } else if (code >= 71 && code <= 77) {
        durumText = "KarlÄ±";
        iconCode = "13d";
      } else if (code >= 80 && code <= 82) {
        durumText = "SaÄŸanak";
        iconCode = "09d";
      } else if (code >= 95) {
        durumText = "FÄ±rtÄ±na";
        iconCode = "11d";
      }

      if (descEl) descEl.innerText = durumText;
      if (iconEl)
        iconEl.src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
    })
    .catch((err) => console.error("Hava hatasÄ±:", err));
}
havaDurumunuGetir();
setInterval(havaDurumunuGetir, 1800000);

// --- GOOGLE SHEETS ENTEGRASYONU ---

// 1. NÃ–BETÃ‡Ä°LER
// function nobetciVerisiGeldi(json) {
//   try {
//     const rows = json.table.rows;
//     const veriler = rows.map((row) => ({
//       gun: (row.c[0] ? row.c[0].v : "").trim(),
//       kat5: row.c[1] ? row.c[1].v : "",
//       kat4: row.c[2] ? row.c[2].v : "-",
//       kat3: row.c[3] ? row.c[3].v : "-",
//       kat2: row.c[4] ? row.c[4].v : "-",
//       zemin: row.c[5] ? row.c[5].v : "-",
//       bahce1: row.c[6] ? row.c[6].v : "-",
//       bahce2: row.c[7] ? row.c[7].v : "-",
//       atolye: row.c[8] ? row.c[8].v : "-",
//       amir: row.c[9] ? row.c[9].v : "-",
//     }));

//     const gunler = [
//       "Pazar",
//       "Pazartesi",
//       "SalÄ±",
//       "Ã‡arÅŸamba",
//       "PerÅŸembe",
//       "Cuma",
//       "Cumartesi",
//     ];
//     const bugun = gunler[new Date().getDay()];

//     console.log(veriler[5].gun);
//     const kayit = veriler.find((x) => x.gun === bugun);

//     const amirBox = document.getElementById("amir-box");
//     const tbody = document.getElementById("duty-body");

//     if (kayit) {
//       if (amirBox) amirBox.innerText = kayit.amir;
//       if (tbody) {
//         tbody.innerHTML = `
//             <tr><td class="duty-place">4. Kat Sol</td><td>${kayit.kat5}</td></tr>
//             <tr><td class="duty-place">4. Kat SaÄŸ</td><td>${kayit.kat4}</td></tr>
//             <tr><td class="duty-place">3. Kat</td><td>${kayit.kat3}</td></tr>
//             <tr><td class="duty-place">2. Kat</td><td>${kayit.kat2}</td></tr>
//             <tr><td class="duty-place">Zemin</td><td>${kayit.zemin}</td></tr>
//             <tr><td class="duty-place">BahÃ§e 1</td><td>${kayit.bahce1}</td></tr>
//             <tr><td class="duty-place">BahÃ§e 2</td><td>${kayit.bahce2}</td></tr>
//             <tr><td class="duty-place">AtÃ¶lye</td><td>${kayit.atolye}</td></tr>
//         `;
//       }
//     } else {
//       if (amirBox) amirBox.innerText = "-";
//       if (tbody)
//         tbody.innerHTML = `<tr><td colspan="2" class="text-center py-3 text-muted">BugÃ¼n iÃ§in nÃ¶bet kaydÄ± yok.</td></tr>`;
//     }
//   } catch (e) {
//     console.log(e);
//   }
// }
function nobetciVerisiGeldi(json) {
  try {
    const rows = json.table.rows;

    const veriler = rows.map((row) => {
      // 1. ADIM: Google Sheets'ten gelen "Date(Y,M,D)" stringini gerÃ§ek tarihe Ã§evirelim
      let tarihObjesi = null;
      if (row.c[0] && row.c[0].v) {
        // "Date(2026,0,4)" iÃ§indeki sayÄ±larÄ± ayÄ±klÄ±yoruz (2026, 0, 4)
        const tarihDegerleri = row.c[0].v.toString().match(/\d+/g);
        if (tarihDegerleri) {
          // new Date(YÄ±l, Ay, GÃ¼n) formatÄ±nda oluÅŸturuyoruz
          tarihObjesi = new Date(
            tarihDegerleri[0], // YÄ±l
            tarihDegerleri[1], // Ay
            tarihDegerleri[2] // GÃ¼n
          );
        }
      }

      return {
        gun: tarihObjesi, // ArtÄ±k burada "Pazartesi" yazÄ±sÄ± deÄŸil, Tarih objesi var
        kat5: row.c[1] ? row.c[1].v : "",
        kat4: row.c[2] ? row.c[2].v : "-",
        kat3: row.c[3] ? row.c[3].v : "-",
        kat2: row.c[4] ? row.c[4].v : "-",
        zemin: row.c[5] ? row.c[5].v : "-",
        bahce1: row.c[6] ? row.c[6].v : "-",
        bahce2: row.c[7] ? row.c[7].v : "-",
        atolye: row.c[8] ? row.c[8].v : "-",
        amir: row.c[9] ? row.c[9].v : "-",
      };
    });

    // 2. ADIM: BugÃ¼nÃ¼n tarihini sadece "GÃ¼n Ay YÄ±l" iÃ§erecek temiz bir formata (String) Ã§eviriyoruz
    const bugunString = new Date().toDateString(); // Ã–rnek: "Sun Jan 04 2026"

    // 3. ADIM: Listeyi tararken her satÄ±rÄ±n tarihini de stringe Ã§evirip kÄ±yaslÄ±yoruz
    const kayit = veriler.find(
      (x) => x.gun && x.gun.toDateString() === bugunString
    );

    const amirBox = document.getElementById("amir-box");
    const tbody = document.getElementById("duty-body");

    if (kayit) {
      if (amirBox) amirBox.innerText = kayit.amir;
      if (tbody) {
        tbody.innerHTML = `
            <tr><td class="duty-place">4. Kat Sol</td><td>${kayit.kat5}</td></tr>
            <tr><td class="duty-place">4. Kat SaÄŸ</td><td>${kayit.kat4}</td></tr>
            <tr><td class="duty-place">3. Kat</td><td>${kayit.kat3}</td></tr>
            <tr><td class="duty-place">2. Kat</td><td>${kayit.kat2}</td></tr>
            <tr><td class="duty-place">Zemin</td><td>${kayit.zemin}</td></tr>
            <tr><td class="duty-place">BahÃ§e 1</td><td>${kayit.bahce1}</td></tr>
            <tr><td class="duty-place">BahÃ§e 2</td><td>${kayit.bahce2}</td></tr>
            <tr><td class="duty-place">AtÃ¶lye</td><td>${kayit.atolye}</td></tr>
        `;
      }
    } else {
      if (amirBox) amirBox.innerText = "-";
      if (tbody)
        tbody.innerHTML = `<tr><td colspan="2" class="text-center py-3 text-muted">BugÃ¼n iÃ§in nÃ¶bet kaydÄ± yok.</td></tr>`;
    }
  } catch (e) {
    console.log(e);
  }
}
// 2. HABERLER (Slider)
function haberVerisiGeldi(json) {
  const rows = json.table.rows;
  let sliderHTML = "";
  let first = true;

  rows.forEach((row) => {
    // const tarih = row.c[0] ? row.c[0].v : "";
    const baslik = row.c[1] ? row.c[1].v : "";
    // const icerik = row.c[2] ? row.c[2].v : "";
    const foto = row.c[3] ? row.c[3].v : "";

    if (foto && baslik) {
      sliderHTML += `
          <div class="carousel-item ${first ? "active" : ""} h-100">
              <img src="${foto}" class="slider-img" style="object-fit:cover; width:100%; height:100%;">
              <div class="carousel-caption d-none d-md-block" style="background: rgba(0,0,0,0.6); border-radius: 10px;">
                  <h5>${baslik}</h5>
              </div>
          </div>`;
      first = false;
    }
  });

  const carouselInner = document.querySelector(".carousel-inner");
  if (sliderHTML && carouselInner) carouselInner.innerHTML = sliderHTML;
}

// 3. DOÄžUM GÃœNLERÄ°
function dogumGunuVerisiGeldi(json) {
  const rows = json.table.rows;
  let html = "";
  rows.forEach((row) => {
    const ad = row.c[0] ? row.c[0].v : "";
    const sinif = row.c[1] ? row.c[1].v : "";
    // const tarih = row.c[2] ? row.c[2].v : "";

    if (ad) {
      html += `
          <li class="list-group-item d-flex justify-content-between align-items-center">
              <div class="fw-bold"><span class="me-2">ðŸŽ‚</span>${ad}</div>
              <span class="badge bg-light text-dark border">${sinif}</span>
          </li>`;
    }
  });
  if (!html)
    html =
      '<li class="list-group-item text-center text-muted">BugÃ¼n doÄŸum gÃ¼nÃ¼ yok.</li>';

  const listEl = document.getElementById("dogum-gunu-listesi");
  if (listEl) listEl.innerHTML = html;
}

// 4. RAPORLULAR
function raporluVerisiGeldi(json) {
  if (!json || !json.table) {
    console.error("Raporlu verisi okunamadÄ± veya boÅŸ!");
    return;
  }

  const rows = json.table.rows;

  // Veriyi iÅŸleyelim
  const veriler = rows.map((r) => ({
    gun: (r.c[0]?.v || "").trim(), // A SÃ¼tunu
    isimler: r.c[1]?.v || "", // B SÃ¼tunu
  }));

  const gunler = [
    "Pazar",
    "Pazartesi",
    "SalÄ±",
    "Ã‡arÅŸamba",
    "PerÅŸembe",
    "Cuma", // BugÃ¼n (02.01.2026) kod buraya bakacak
    "Cumartesi",
  ];

  const bugunIndex = new Date().getDay();
  const bugunIsmi = gunler[bugunIndex];

  const kayit = veriler.find(
    (x) => x.gun.toLowerCase() === bugunIsmi.toLowerCase()
  );

  let html = "";
  if (kayit && kayit.isimler) {
    const isimler = kayit.isimler.split(",");
    isimler.forEach((isim) => {
      if (isim.trim()) {
        html += `<li class="list-group-item fw-bold text-danger"><i class="bi bi-bandaid me-2"></i>${isim.trim()}</li>`;
      }
    });
  }

  if (!html)
    html = `<li class="list-group-item text-center text-success fw-bold"><i class="bi bi-check-circle me-2"></i>Raporlu Ã¶ÄŸretmen yok.</li>`;

  const listEl = document.getElementById("raporlu-listesi");
  if (listEl) listEl.innerHTML = html;
}

// 5. Ã–ZEL GÃœNLER
document.addEventListener("DOMContentLoaded", () => {
  const specificDays = [
    { start: "01-01", end: "01-01", title: "YÄ±lbaÅŸÄ±" },
    { start: "03-01", end: "03-07", title: "YeÅŸilay HaftasÄ±" },
    { start: "03-08", end: "03-08", title: "DÃ¼nya KadÄ±nlar GÃ¼nÃ¼" },
    { start: "03-12", end: "03-12", title: "Ä°stiklal MarÅŸÄ±'nÄ±n KabulÃ¼" },
    { start: "03-18", end: "03-18", title: "Ã‡anakkale Zaferi" },
    {
      start: "04-23",
      end: "04-23",
      title: "23 Nisan Ulusal Egemenlik ve Ã‡ocuk BayramÄ±",
    },
    { start: "05-01", end: "05-07", title: "BiliÅŸim HaftasÄ±" },
    {
      start: "05-19",
      end: "05-19",
      title: "19 MayÄ±s AtatÃ¼rk'Ã¼ Anma, GenÃ§lik ve Spor BayramÄ±",
    },
    { start: "05-29", end: "05-29", title: "Ä°stanbul'un Fethi" },
    { start: "06-01", end: "06-07", title: "Ã‡evre HaftasÄ±" },
    { start: "08-30", end: "08-30", title: "30 AÄŸustos Zafer BayramÄ±" },
    { start: "09-15", end: "09-22", title: "Ä°lkÃ¶ÄŸretim HaftasÄ±" },
    { start: "10-04", end: "10-04", title: "HayvanlarÄ± Koruma GÃ¼nÃ¼" },
    { start: "10-29", end: "10-29", title: "Cumhuriyet BayramÄ±" },
    { start: "11-10", end: "11-16", title: "AtatÃ¼rk HaftasÄ±" },
    { start: "11-24", end: "11-24", title: "Ã–ÄŸretmenler GÃ¼nÃ¼" },
    { start: "12-27", end: "12-27", title: "Mehmet Akif Ersoy'u Anma GÃ¼nÃ¼" },
  ];

  function updateSpecialDays() {
    const listElement = document.getElementById("ozel-gun-listesi");
    if (!listElement) return;

    listElement.innerHTML = "";

    const today = new Date();
    const month = String(today.getMonth() + 1).padStart(2, "0");
    const day = String(today.getDate()).padStart(2, "0");
    const currentCode = `${month}-${day}`;

    let activeEvent = specificDays.find(
      (d) => currentCode >= d.start && currentCode <= d.end
    );

    if (activeEvent) {
      const li = document.createElement("li");
      li.className = "list-group-item ozel-gun-item bg-light";
      li.innerHTML = `<span class="badge bg-danger mb-2">BUGÃœN</span><br>${activeEvent.title}`;
      listElement.appendChild(li);
    } else {
      let nextEvent = specificDays.find((d) => d.start > currentCode);
      if (!nextEvent) nextEvent = specificDays[0];

      if (nextEvent) {
        const li = document.createElement("li");
        li.className = "list-group-item ozel-gun-item";
        const [m, d] = nextEvent.start.split("-");
        const dateObj = new Date(today.getFullYear(), m - 1, d);
        const dateStr = dateObj.toLocaleDateString("tr-TR", {
          month: "long",
          day: "numeric",
        });

        li.innerHTML = `<span class="tarih-badge">YAKLAÅžIYOR (${dateStr})</span>${nextEvent.title}`;
        listElement.appendChild(li);
      }
    }
  }

  updateSpecialDays();
  setInterval(updateSpecialDays, 3600000);
});

// --- 6. DUYURULAR (YENÄ° EKLENEN KISIM) ---
let duyuruListesi = [];
let duyuruIndex = 0;

function duyuruVerisiGeldi(json) {
  const rows = json.table.rows;
  // Sadece A SÃ¼tununu (c[0]) alÄ±yoruz, boÅŸ olmayanlarÄ± filtreliyoruz
  duyuruListesi = rows.map((r) => r.c[0]?.v).filter((v) => v);

  if (duyuruListesi.length === 0) {
    duyuruListesi = ["Aktif duyuru bulunmamaktadÄ±r."];
  }

  // EÄŸer dÃ¶ngÃ¼ henÃ¼z baÅŸlamadÄ±ysa baÅŸlat
  const element = document.getElementById("duyuru-metni");
  if (element && !element.classList.contains("animasyon-basladi")) {
    element.classList.add("animasyon-basladi");
    duyuruDongusu();
    setInterval(duyuruDongusu, 5000); // 5 Saniyede bir deÄŸiÅŸtir
  }
}

function duyuruDongusu() {
  const element = document.getElementById("duyuru-metni");
  if (!element) return;

  element.classList.remove("aktif"); // Ã–nce silikleÅŸtir
  setTimeout(() => {
    element.innerHTML = duyuruListesi[duyuruIndex]; // YazÄ±yÄ± deÄŸiÅŸtir
    element.classList.add("aktif"); // GÃ¶rÃ¼nÃ¼r yap
    // SÄ±radaki duyuruya geÃ§
    duyuruIndex = (duyuruIndex + 1) % duyuruListesi.length;
  }, 500); // CSS transition sÃ¼resi kadar bekle
}

// --- VERÄ° Ã‡EKÄ°CÄ° (ORTAK) ---
function loadData(sheetName, query, callbackName) {
  const old = document.getElementById("script-" + sheetName);
  if (old) old.remove();

  const script = document.createElement("script");
  script.id = "script-" + sheetName;
  // query: select * gibi sorgular, callbackName: veriyi karÅŸÄ±layacak fonksiyon
  script.src = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheetName}&tq=${encodeURIComponent(
    query
  )}&tqx=responseHandler:${callbackName}&_=${Date.now()}`;
  document.body.appendChild(script);
}

// --- VERÄ°LERÄ° YÃœKLEME / GÃœNCELLEME ---
function refreshAll() {
  // Sheet sekme isimlerinin (Sayfa1, Haberler vs) Excel ile BÄ°REBÄ°R aynÄ± olduÄŸundan emin olun.
  loadData("Sayfa1", "", "nobetciVerisiGeldi");
  loadData("Haberler", "", "haberVerisiGeldi");
  loadData("DogumGunleri", "", "dogumGunuVerisiGeldi");
  loadData("Raporlular", "", "raporluVerisiGeldi");
  loadData("DersProgrami", "", "shludeVerisiGeldi");

  // DÃ¼zeltilen KÄ±sÄ±m: Sorgu 'select A' (Sadece A sÃ¼tunu), Fonksiyon 'duyuruVerisiGeldi'
  loadData("Duyurular", "", "duyuruVerisiGeldi");
}

refreshAll();
setInterval(refreshAll, 60000); // 1 Dakikada bir verileri tazele

// 1 Saatte bir sayfayÄ± komple yenile (Bellek temizliÄŸi iÃ§in iyi bir pratik)
setTimeout(() => window.location.reload(), 3600000);
document.addEventListener("DOMContentLoaded", () => {
  author = document.getElementById("author");
  author.innerHTML =
    'HazÄ±rlayan: <i class="bi bi-code-slash"></i> Kadir KAVAL<i class="bi bi-code-slash"></i>';
});

     </script>
</body>

</html>