<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Okul Dijital Panosu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        /* --- GENEL AYARLAR --- */
        :root {
            --bg-color: #eef1f5;
            --box-bg: #ffffff;
            --header-blue: #0d47a1;
            --header-cyan: #0097a7;
            --header-purple: #7b1fa2;
            --header-red: #d32f2f;
            --active-row: #ffe082;
            /* Ekran boyutuna gÃ¶re otomatik Ã¶lÃ§eklenen yazÄ± boyutu */
            font-size: 1.4vmin;
        }

        html, body {
            height: 100vh;
            width: 100vw;
            margin: 0;
            overflow: hidden; /* TaÅŸmayÄ± engelle */
            background-color: var(--bg-color);
            font-family: "Segoe UI", sans-serif;
        }

        .container-fluid {
            height: 100%;
            padding: 1vmin;
            padding-bottom: 5vmin; /* Footer payÄ± */
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        /* --- IZGARA (GRID) YAPISI --- */
        .main-grid {
            display: grid;
            grid-template-columns: 20% 55% 25%; /* Sol - Orta - SaÄŸ Panel OranlarÄ± */
            gap: 1vmin;
            height: 100%;
            overflow: hidden;
        }

        .col-panel {
            display: flex;
            flex-direction: column;
            gap: 1vmin;
            height: 100%;
            overflow: hidden;
        }

        /* --- KART GÃ–RÃœNÃœMÃœ --- */
        .pano-card {
            background: var(--box-bg);
            border-radius: 1vmin;
            box-shadow: 0 0.5vmin 1vmin rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        .card-header {
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 0.6vmin;
            font-size: 1.2rem;
            text-transform: uppercase;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .card-body {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            padding: 0.5vmin !important;
            overflow: hidden;
            position: relative;
            min-height: 0;
        }

        .text-center-box {
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* --- ORTA PANEL YÃœKSEKLÄ°K AYARLARI --- */
        .slider-wrapper { flex: 3.5; }
        .schedule-area { flex: 5; }
        .time-out-card { flex: 1.5; }

        /* --- METÄ°N STÄ°LLERÄ° --- */
        .clock-box {
            font-size: 3.5rem;
            font-weight: bold;
            color: #333;
            line-height: 1;
        }

        .date-box {
            font-size: 1.1rem;
            color: #555;
        }

        .weather-temp {
            font-size: 3rem;
            font-weight: bold;
            color: var(--header-cyan);
            line-height: 1;
        }

        .countdown-box {
            font-size: 4rem;
            font-weight: bold;
            color: white;
            line-height: 1;
        }

        /* --- TABLO TASARIMLARI --- */
        .time-table, .duty-table {
            width: 100%;
            border-collapse: collapse;
            height: 100%;
            table-layout: fixed;
        }

        .time-table th, .duty-table th {
            background: #eee;
            padding: 0.5vmin;
            position: sticky;
            top: 0;
            z-index: 2;
            font-size: 1rem;
            text-align: center;
        }

        .time-table td, .duty-table td {
            border-bottom: 1px solid #ddd;
            padding: 0;
            text-align: center;
            vertical-align: middle;
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #nobetci-table td, #nobetci-table th {
            text-align: start;
            padding: 1vmin;
            font-weight: 500;
        }

        .active-slot {
            background-color: #f0e4c6 !important;
            font-weight: bold;
            border-left: 0.8vmin solid #d32f2f;
        }

        /* --- DUYURU ANÄ°MASYONU --- */
        .duyuru-container {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .duyuru-text {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s;
            font-size: 1.5rem;
            font-weight: 600;
            text-align: center;
        }

        .duyuru-text.aktif {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }

        /* --- RENKLER --- */
        .bg-blue { background-color: var(--header-blue) !important; }
        .bg-cyan { background-color: var(--header-cyan) !important; }
        .bg-purple { background-color: var(--header-purple) !important; }
        .bg-red { background-color: var(--header-red) !important; }
        .bg-light-gray { background-color: #f8f9fa; }

        /* --- ALT BÄ°LGÄ° (FOOTER) --- */
        .site-footer {
            height: 6vmin;
            background: linear-gradient(90deg, #0d47a1 0%, #1565c0 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2vmin;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            z-index: 1050;
            border-top: 0.4vmin solid #fbc02d;
            font-size: 1rem;
        }

        .footer-school-name {
            font-weight: 600;
            font-size: 2rem;
        }

        .list-group-item {
            background: transparent;
            padding: 0.5vmin 1vmin;
            font-size: 1rem;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="main-grid">

            <div class="col-panel">
                <div class="pano-card" style="flex: 0.8;">
                    <div class="card-header bg-cyan">SAAT & TARÄ°H</div>
                    <div class="card-body text-center-box">
                        <i class="bi bi-clock fw-bold" style="font-size: 3rem; color: var(--header-blue);"></i>
                        <div class="clock-box" id="liveClock">--:--</div>
                        <div class="date-box fw-semibold" id="dateTime">--.--.2025</div>
                    </div>
                </div>

                <div class="pano-card" style="flex: 1;">
                    <div class="card-header bg-success">HAVA DURUMU</div>
                    <div class="card-body text-center-box">
                        <img id="js-weather-icon" src="https://openweathermap.org/img/wn/02d@2x.png"
                            style="width: 8vmin;">
                        <div id="js-weather-temp" class="weather-temp">--Â°</div>
                        <div id="js-weather-desc" class="text-secondary fw-bold">YÃ¼kleniyor</div>
                    </div>
                </div>

                <div class="pano-card bg-light-gray" style="flex: 2;">
                    <div class="card-header bg-red">DUYURULAR</div>
                    <div class="card-body">
                        <div class="duyuru-container">
                            <div id="duyuru-metni" class="duyuru-text">
                                Duyurular yÃ¼kleniyor...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-panel">
                <div class="pano-card slider-wrapper">
                    <div id="carouselExample" class="carousel slide h-100" data-bs-ride="carousel">
                        <div class="carousel-inner h-100" id="new-foto">
                            <div class="carousel-item active h-100">
                                <img src="https://picsum.photos/1200/600" class="d-block w-100 h-100"
                                    style="object-fit: cover;">
                                <div class="carousel-caption d-none d-md-block"
                                    style="background: rgba(0,0,0,0.5); border-radius: 10px;">
                                    <h5>Okul Dijital Pano Sistemi</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pano-card schedule-area">
                    <div class="card-header bg-blue">DERS PROGRAMI</div>
                    <div class="card-body">
                        <table class="time-table">
                            <thead>
                                <tr>
                                    <th>Ders</th>
                                    <th>GiriÅŸ</th>
                                    <th>Ã‡Ä±kÄ±ÅŸ</th>
                                    <th>SÃ¼re</th>
                                </tr>
                            </thead>
                            <tbody id="scheduleBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="pano-card bg-light-gray time-out-card">
                    <div class="card-header bg-red">KALAN SÃœRE</div>
                    <div class="card-body text-center-box">
                        <div class="status-text fw-bold" id="bellStatus">Kontrol Ediliyor...</div>
                        <div class="countdown-box fw-bold" id="countdown">--:--</div>
                    </div>
                </div>
            </div>

            <div class="col-panel">
                <div class="pano-card" style="flex: 2;">
                    <div class="card-header bg-blue">NÃ–BETÃ‡Ä° Ã–ÄžRETMENLER</div>
                    <div class="card-body">
                        <div class="border-bottom flex-row d-flex justify-content-start align-items-center p-2">
                            <div class="text-muted fw-bold m-1">NÃ¶betÃ§i Mdr. Yrd:</div>
                            <div id="amir-box" class="fw-bold text-danger">-</div>
                        </div>
                        <div style="flex-grow: 1; overflow-y: auto;">
                            <table class="duty-table" id="nobetci-table">
                                <thead>
                                    <tr class="text-muted">
                                        <th>Kat</th>
                                        <th>Ã–ÄŸretmen</th>
                                    </tr>
                                </thead>
                                <tbody id="duty-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="pano-card" style="flex: 1;">
                    <div class="card-header bg-red">RAPORLU / Ä°ZÄ°NLÄ°</div>
                    <div class="card-body" style="overflow-y: auto;">
                        <ul id="raporlu-listesi" class="list-group list-group-flush w-100"></ul>
                    </div>
                </div>

                <div class="pano-card" style="flex: 1;">
                    <div class="card-header bg-purple">BELÄ°RLÄ° GÃœNLER</div>
                    <div class="card-body" style="overflow-y: auto;">
                        <ul id="ozel-gun-listesi" class="list-group list-group-flush w-100 text-center"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-logo">BiliÅŸim Teknolojileri - Okul Dijital Panosu v1.0</div>
        <div class="footer-school-name">BORSA Ä°STANBUL MEHMET AKÄ°F ERSOY M.T.A.L</div>
        <div class="footer-creator text-reset" id="author">HazÄ±rlayan:</div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ==========================================
        //         AYARLAR (CONFIG)
        // ==========================================
        // Google Sheet ID (TarayÄ±cÄ±daki URL'den alÄ±nÄ±r)
        const SHEET_ID = "1Nc2616kCclHxdIBfxSdcL9XOGXF1vRG_JEtwNqQHkvw";
        
        // Hava Durumu KoordinatlarÄ± (AdapazarÄ±)
        const LAT = 40.77; 
        const LON = 30.4;
        
        // ==========================================


        // --- 1. ZAMAN Ã‡Ä°ZELGESÄ° (Ders ProgramÄ±) ---
        const schedule = [];
        
        // DÃ¼zeltme: Fonksiyon ismi refreshAll iÃ§indeki Ã§aÄŸrÄ± ile eÅŸleÅŸtirildi.
        function scheduleVerisiGeldi(json) {
            const rows = json.table.rows.slice(1); // BaÅŸlÄ±klarÄ± at
            const veriler = rows.map((row) => ({
                no: row.c[0] ? row.c[0].v : "",
                start: row.c[1] ? row.c[1].v : "",
                end: row.c[2] ? row.c[2].v : "",
            }));
            schedule.length = 0;
            veriler.forEach((item) => {
                if (item.no && item.start && item.end) {
                    schedule.push({ no: item.no, start: item.start, end: item.end });
                }
            });
            renderTable();
        };

        renderTable();
        function renderTable() {
            const tbody = document.getElementById("scheduleBody");
            if (!tbody) return; 
            let html = "";
            schedule.forEach((item) => {
                html += `<tr id="row-${item.no}">
                        <td>${item.no}. Ders</td>
                        <td>${item.start}</td>
                        <td>${item.end}</td>
                        <td>40dk</td>
                      </tr>`;
            });
            tbody.innerHTML = html;
        }

        // --- 2. CANLI SAAT VE DERS DURUMU ---
        function updateClock() {
            const now = new Date();
            const dateEl = document.getElementById("dateTime");
            const clockEl = document.getElementById("liveClock");

            if (dateEl)
                dateEl.innerText = now.toLocaleDateString("tr-TR", {
                    day: "2-digit",
                    month: "long",
                    year: "numeric",
                    weekday: "long",
                });
            if (clockEl)
                clockEl.innerText = now.toLocaleTimeString("tr-TR", {
                    hour: "2-digit",
                    minute: "2-digit",
                });
        }

        function updateSystem() {
            updateClock();
            const now = new Date();
            const currentMin = now.getHours() * 60 + now.getMinutes();
            const seconds = now.getSeconds();

            document
                .querySelectorAll("tr")
                .forEach((tr) => tr.classList.remove("active-slot"));

            let activeFound = false;
            const statusEl = document.getElementById("bellStatus");
            const countEl = document.getElementById("countdown");

            if (!statusEl || !countEl) return;

            for (let i = 0; i < schedule.length; i++) {
                const lesson = schedule[i];

                const [sh, sm] = lesson.start.split(":").map(Number);
                const [eh, em] = lesson.end.split(":").map(Number);
                const startMin = sh * 60 + sm;
                const endMin = eh * 60 + em;

                // Ders iÃ§inde miyiz?
                if (currentMin >= startMin && currentMin < endMin) {
                    const diffMin = endMin - currentMin - 1;
                    const diffSec = 60 - seconds;
                    statusEl.innerText = `${lesson.no}. DERSÄ°N BÄ°TÄ°MÄ°NE:`;
                    countEl.innerText = `${diffMin}:${diffSec < 10 ? "0" + diffSec : diffSec}`;

                    const row = document.getElementById(`row-${lesson.no}`);
                    if (row) row.classList.add("active-slot");

                    countEl.style.color = "#dc3545"; // KÄ±rmÄ±zÄ± (Ders)
                    activeFound = true;
                    break;
                }

                // TeneffÃ¼ste miyiz?
                if (i < schedule.length - 1) {
                    const nextLessonStart = schedule[i + 1].start.split(":");
                    const nextStartMin =
                        parseInt(nextLessonStart[0]) * 60 + parseInt(nextLessonStart[1]);

                    if (currentMin >= endMin && currentMin < nextStartMin) {
                        const diffMin = nextStartMin - currentMin - 1;
                        const diffSec = 60 - seconds;
                        statusEl.innerText = `TENEFFÃœS`;
                        countEl.innerText = `${diffMin}:${diffSec < 10 ? "0" + diffSec : diffSec}`;
                        countEl.style.color = "#198754"; // YeÅŸil (TeneffÃ¼s)
                        activeFound = true;
                        break;
                    }
                }
            }
            if (!activeFound) {
                statusEl.innerText = "GÄ°RÄ°Åž / Ã‡IKIÅž";
                countEl.innerText = "--:--";
                countEl.style.color = "#333"; 
            }
        }
        setInterval(updateSystem, 1000);

        // --- 3. HAVA DURUMU ---
        function havaDurumunuGetir() {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true&timezone=auto&_=${Date.now()}`;
            fetch(url)
                .then((response) => response.json())
                .then((data) => {
                    const weather = data.current_weather;
                    const temp = Math.round(weather.temperature);
                    const code = weather.weathercode;

                    const tempEl = document.getElementById("js-weather-temp");
                    const descEl = document.getElementById("js-weather-desc");
                    const iconEl = document.getElementById("js-weather-icon");

                    if (tempEl) tempEl.innerText = `${temp}Â°`;

                    let durumText = "Bilinmiyor";
                    let iconCode = "01d";

                    // WMO Weather Codes mapping
                    if (code === 0) {
                        durumText = "AÃ§Ä±k"; iconCode = "01d";
                    } else if (code >= 1 && code <= 3) {
                        durumText = "Bulutlu"; iconCode = "02d";
                    } else if (code >= 45 && code <= 48) {
                        durumText = "Sisli"; iconCode = "50d";
                    } else if (code >= 51 && code <= 67) {
                        durumText = "YaÄŸmurlu"; iconCode = "10d";
                    } else if (code >= 71 && code <= 77) {
                        durumText = "KarlÄ±"; iconCode = "13d";
                    } else if (code >= 80 && code <= 82) {
                        durumText = "SaÄŸanak"; iconCode = "09d";
                    } else if (code >= 95) {
                        durumText = "FÄ±rtÄ±na"; iconCode = "11d";
                    }

                    if (descEl) descEl.innerText = durumText;
                    if (iconEl)
                        iconEl.src = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
                })
                .catch((err) => console.error("Hava hatasÄ±:", err));
        }
        havaDurumunuGetir();
        setInterval(havaDurumunuGetir, 1800000); // 30 dakikada bir gÃ¼ncelle

        // --- GOOGLE SHEETS ENTEGRASYONU ---

        // 4. NÃ–BETÃ‡Ä°LER
        function nobetciVerisiGeldi(json) {
            try {
                const rows = json.table.rows;

                const veriler = rows.map((row) => {
                    // Google Sheets'ten gelen Date(Y,M,D) formatÄ±nÄ± iÅŸle
                    let tarihObjesi = null;
                    if (row.c[0] && row.c[0].v) {
                        const tarihDegerleri = row.c[0].v.toString().match(/\d+/g);
                        if (tarihDegerleri) {
                            tarihObjesi = new Date(
                                tarihDegerleri[0], // YÄ±l
                                tarihDegerleri[1], // Ay (0-11)
                                tarihDegerleri[2]  // GÃ¼n
                            );
                        }
                    }

                    return {
                        gun: tarihObjesi,
                        kat5: row.c[1] ? row.c[1].v : "",
                        kat4: row.c[2] ? row.c[2].v : "-",
                        kat3: row.c[3] ? row.c[3].v : "-",
                        kat2: row.c[4] ? row.c[4].v : "-",
                        zemin: row.c[5] ? row.c[5].v : "-",
                        bahce1: row.c[6] ? row.c[6].v : "-",
                        bahce2: row.c[7] ? row.c[7].v : "-",
                        atolye: row.c[8] ? row.c[8].v : "-",
                        amir: row.c[9] ? row.c[9].v : "-",
                    };
                });

                // BugÃ¼nÃ¼ bul
                const bugunString = new Date().toDateString(); 

                const kayit = veriler.find(
                    (x) => x.gun && x.gun.toDateString() === bugunString
                );

                const amirBox = document.getElementById("amir-box");
                const tbody = document.getElementById("duty-body");

                if (kayit) {
                    if (amirBox) amirBox.innerText = kayit.amir;
                    if (tbody) {
                        tbody.innerHTML = `
                            <tr><td class="duty-place">4. Kat Sol</td><td>${kayit.kat5}</td></tr>
                            <tr><td class="duty-place">4. Kat SaÄŸ</td><td>${kayit.kat4}</td></tr>
                            <tr><td class="duty-place">3. Kat</td><td>${kayit.kat3}</td></tr>
                            <tr><td class="duty-place">2. Kat</td><td>${kayit.kat2}</td></tr>
                            <tr><td class="duty-place">Zemin</td><td>${kayit.zemin}</td></tr>
                            <tr><td class="duty-place">BahÃ§e 1</td><td>${kayit.bahce1}</td></tr>
                            <tr><td class="duty-place">BahÃ§e 2</td><td>${kayit.bahce2}</td></tr>
                            <tr><td class="duty-place">AtÃ¶lye</td><td>${kayit.atolye}</td></tr>
                        `;
                    }
                } else {
                    if (amirBox) amirBox.innerText = "-";
                    if (tbody)
                        tbody.innerHTML = `<tr><td colspan="2" class="text-center py-3 text-muted">BugÃ¼n iÃ§in nÃ¶bet kaydÄ± yok.</td></tr>`;
                }
            } catch (e) {
                console.log(e);
            }
        }

        // 5. HABERLER (Slider)
        function haberVerisiGeldi(json) {
            const rows = json.table.rows;
            let sliderHTML = "";
            let first = true;

            rows.forEach((row) => {
                const baslik = row.c[1] ? row.c[1].v : "";
                const foto = row.c[3] ? row.c[3].v : "";

                if (foto && baslik) {
                    sliderHTML += `
                      <div class="carousel-item ${first ? "active" : ""} h-100">
                          <img src="${foto}" class="slider-img" style="object-fit:cover; width:100%; height:100%;">
                          <div class="carousel-caption d-none d-md-block" style="background: rgba(0,0,0,0.6); border-radius: 10px;">
                              <h5>${baslik}</h5>
                          </div>
                      </div>`;
                    first = false;
                }
            });

            const carouselInner = document.querySelector(".carousel-inner");
            if (sliderHTML && carouselInner) carouselInner.innerHTML = sliderHTML;
        }

        // 6. DOÄžUM GÃœNLERÄ°
        function dogumGunuVerisiGeldi(json) {
            const rows = json.table.rows;
            let html = "";
            rows.forEach((row) => {
                const ad = row.c[0] ? row.c[0].v : "";
                const sinif = row.c[1] ? row.c[1].v : "";

                if (ad) {
                    html += `
                      <li class="list-group-item d-flex justify-content-between align-items-center">
                          <div class="fw-bold"><span class="me-2">ðŸŽ‚</span>${ad}</div>
                          <span class="badge bg-light text-dark border">${sinif}</span>
                      </li>`;
                }
            });
            if (!html)
                html = '<li class="list-group-item text-center text-muted">BugÃ¼n doÄŸum gÃ¼nÃ¼ yok.</li>';

            const listEl = document.getElementById("dogum-gunu-listesi");
            if (listEl) listEl.innerHTML = html;
        }

        // 7. RAPORLULAR
        function raporluVerisiGeldi(json) {
            if (!json || !json.table) {
                console.error("Raporlu verisi okunamadÄ± veya boÅŸ!");
                return;
            }

            const rows = json.table.rows;
            const veriler = rows.map((r) => ({
                gun: (r.c[0]?.v || "").trim(), // A SÃ¼tunu (GÃ¼n adÄ±: Cuma vb.)
                isimler: r.c[1]?.v || "",      // B SÃ¼tunu (Ã–ÄŸretmen Ä°simleri)
            }));

            const gunler = ["Pazar","Pazartesi","SalÄ±","Ã‡arÅŸamba","PerÅŸembe","Cuma","Cumartesi"];
            const bugunIndex = new Date().getDay();
            const bugunIsmi = gunler[bugunIndex];

            const kayit = veriler.find(
                (x) => x.gun.toLowerCase() === bugunIsmi.toLowerCase()
            );

            let html = "";
            if (kayit && kayit.isimler) {
                const isimler = kayit.isimler.split(",");
                isimler.forEach((isim) => {
                    if (isim.trim()) {
                        html += `<li class="list-group-item fw-bold text-danger"><i class="bi bi-bandaid me-2"></i>${isim.trim()}</li>`;
                    }
                });
            }

            if (!html)
                html = `<li class="list-group-item text-center text-success fw-bold"><i class="bi bi-check-circle me-2"></i>Raporlu Ã¶ÄŸretmen yok.</li>`;

            const listEl = document.getElementById("raporlu-listesi");
            if (listEl) listEl.innerHTML = html;
        }

        // 8. Ã–ZEL GÃœNLER
        document.addEventListener("DOMContentLoaded", () => {
            const specificDays = [
                { start: "01-01", end: "01-01", title: "YÄ±lbaÅŸÄ±" },
                { start: "03-01", end: "03-07", title: "YeÅŸilay HaftasÄ±" },
                { start: "03-08", end: "03-08", title: "DÃ¼nya KadÄ±nlar GÃ¼nÃ¼" },
                { start: "03-12", end: "03-12", title: "Ä°stiklal MarÅŸÄ±'nÄ±n KabulÃ¼" },
                { start: "03-18", end: "03-18", title: "Ã‡anakkale Zaferi" },
                { start: "04-23", end: "04-23", title: "23 Nisan Ulusal Egemenlik ve Ã‡ocuk BayramÄ±" },
                { start: "05-01", end: "05-07", title: "BiliÅŸim HaftasÄ±" },
                { start: "05-19", end: "05-19", title: "19 MayÄ±s AtatÃ¼rk'Ã¼ Anma, GenÃ§lik ve Spor BayramÄ±" },
                { start: "05-29", end: "05-29", title: "Ä°stanbul'un Fethi" },
                { start: "06-01", end: "06-07", title: "Ã‡evre HaftasÄ±" },
                { start: "08-30", end: "08-30", title: "30 AÄŸustos Zafer BayramÄ±" },
                { start: "09-15", end: "09-22", title: "Ä°lkÃ¶ÄŸretim HaftasÄ±" },
                { start: "10-04", end: "10-04", title: "HayvanlarÄ± Koruma GÃ¼nÃ¼" },
                { start: "10-29", end: "10-29", title: "Cumhuriyet BayramÄ±" },
                { start: "11-10", end: "11-16", title: "AtatÃ¼rk HaftasÄ±" },
                { start: "11-24", end: "11-24", title: "Ã–ÄŸretmenler GÃ¼nÃ¼" },
                { start: "12-27", end: "12-27", title: "Mehmet Akif Ersoy'u Anma GÃ¼nÃ¼" },
            ];

            function updateSpecialDays() {
                const listElement = document.getElementById("ozel-gun-listesi");
                if (!listElement) return;

                listElement.innerHTML = "";

                const today = new Date();
                const month = String(today.getMonth() + 1).padStart(2, "0");
                const day = String(today.getDate()).padStart(2, "0");
                const currentCode = `${month}-${day}`;

                let activeEvent = specificDays.find(
                    (d) => currentCode >= d.start && currentCode <= d.end
                );

                if (activeEvent) {
                    const li = document.createElement("li");
                    li.className = "list-group-item ozel-gun-item bg-light";
                    li.innerHTML = `<span class="badge bg-danger mb-2">BUGÃœN</span><br>${activeEvent.title}`;
                    listElement.appendChild(li);
                } else {
                    let nextEvent = specificDays.find((d) => d.start > currentCode);
                    if (!nextEvent) nextEvent = specificDays[0];

                    if (nextEvent) {
                        const li = document.createElement("li");
                        li.className = "list-group-item ozel-gun-item";
                        const [m, d] = nextEvent.start.split("-");
                        const dateObj = new Date(today.getFullYear(), m - 1, d);
                        const dateStr = dateObj.toLocaleDateString("tr-TR", {
                            month: "long",
                            day: "numeric",
                        });

                        li.innerHTML = `<span class="badge bg-secondary mb-1">YAKLAÅžIYOR (${dateStr})</span><br>${nextEvent.title}`;
                        listElement.appendChild(li);
                    }
                }
            }

            updateSpecialDays();
            setInterval(updateSpecialDays, 3600000); // 1 saatte bir kontrol
        });

        // 9. DUYURULAR
        let duyuruListesi = [];
        let duyuruIndex = 0;

        function duyuruVerisiGeldi(json) {
            const rows = json.table.rows;
            // Sadece A SÃ¼tununu al
            duyuruListesi = rows.map((r) => r.c[0]?.v).filter((v) => v);

            if (duyuruListesi.length === 0) {
                duyuruListesi = ["Aktif duyuru bulunmamaktadÄ±r."];
            }

            // DÃ¶ngÃ¼yÃ¼ baÅŸlat
            const element = document.getElementById("duyuru-metni");
            if (element && !element.classList.contains("animasyon-basladi")) {
                element.classList.add("animasyon-basladi");
                duyuruDongusu();
                setInterval(duyuruDongusu, 5000); // 5 saniyede bir deÄŸiÅŸtir
            }
        }

        function duyuruDongusu() {
            const element = document.getElementById("duyuru-metni");
            if (!element) return;

            element.classList.remove("aktif");
            setTimeout(() => {
                element.innerHTML = duyuruListesi[duyuruIndex];
                element.classList.add("aktif");
                duyuruIndex = (duyuruIndex + 1) % duyuruListesi.length;
            }, 500);
        }

        // --- VERÄ° Ã‡EKÄ°CÄ° (ANA MOTOR) ---
        function loadData(sheetName, query, callbackName) {
            const old = document.getElementById("script-" + sheetName);
            if (old) old.remove();

            const script = document.createElement("script");
            script.id = "script-" + sheetName;
            script.src = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheetName}&tq=${encodeURIComponent(
                query
            )}&tqx=responseHandler:${callbackName}&_=${Date.now()}`;
            document.body.appendChild(script);
        }

        // --- GÃœNCELLEME SIKLIÄžI ---
        function refreshAll() {
            // Excel'deki Sayfa isimleriyle buradakiler birebir aynÄ± olmalÄ±
            loadData("Sayfa1", "", "nobetciVerisiGeldi");
            loadData("Haberler", "", "haberVerisiGeldi");
            loadData("DogumGunleri", "", "dogumGunuVerisiGeldi");
            loadData("Raporlular", "", "raporluVerisiGeldi");
            // Dikkat: Fonksiyon ismini dÃ¼zelttik
            loadData("DersProgrami", "", "scheduleVerisiGeldi"); 
            loadData("Duyurular", "select A", "duyuruVerisiGeldi");
        }

        refreshAll();
        setInterval(refreshAll, 60000); // 1 dakikada bir verileri tazele

        // 1 saatte bir sayfayÄ± tamamen yenile (Uzun sÃ¼re aÃ§Ä±k kalan ekranlar iÃ§in bellek temizliÄŸi)
        setTimeout(() => window.location.reload(), 3600000);

        // Footer Author
        document.addEventListener("DOMContentLoaded", () => {
            const author = document.getElementById("author");
            author.innerHTML = 'HazÄ±rlayan: <i class="bi bi-code-slash"></i> Kadir KAVAL <i class="bi bi-code-slash"></i>';
        });

    </script>

</body>
</html>